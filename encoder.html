<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Encoder Rev2</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  font: 14px Arial, sans-serif;
  background: #0b0b0b;
  color: #f2f2f2;
}

.wrap {
  max-width: 1000px;
  margin: 20px auto;
  padding: 18px;
}

h1 {
  margin: 0 0 12px 0;
  font-weight: 600;
}

small {
  color: #b7b7b7;
}

label {
  display: block;
  margin: 14px 0 6px 0;
}

input[type="text"], textarea, select {
  width: 100%;
  box-sizing: border-box;
  background: #111;
  color: #f2f2f2;
  border: 1px solid #333;
  padding: 10px;
  border-radius: 6px;
  outline: none;
}

textarea {
  min-height: 90px;
  resize: vertical;
}

.row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

.btns {
  display: flex;
  gap: 10px;
  margin-top: 14px;
  flex-wrap: wrap;
}

button {
  background: #1f6feb;
  color: #fff;
  border: 0;
  padding: 10px 14px;
  border-radius: 6px;
  cursor: pointer;
}

button.secondary {
  background: #333;
}

.code {
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  font-size: 13px;
}
</style>
</head>

<body>
<div class="wrap">

<h1>Wallboard URL Encoder Rev2</h1>

<small>
Paste a stream URL below. This page generates a fully ready-to-use
player.html link with proper encoding (single encode only).
No double encoding.
</small>

<label for="base">Player base URL</label>
<input id="base" type="text"
value="https://solutionssquad.github.io/shulboard/player.html" />

<label for="src">Stream URL (.m3u8 or other)</label>
<textarea id="src" placeholder="https://example.com/live/master.m3u8"></textarea>

<div class="row">
  <div>
    <label for="fit">fit</label>
    <select id="fit">
      <option value="contain" selected>contain (no crop, may show bars)</option>
      <option value="cover">cover (crop-fill, no bars)</option>
    </select>
  </div>
  <div>
    <label for="muted">muted</label>
    <select id="muted">
      <option value="1" selected>1 (recommended)</option>
      <option value="0">0</option>
    </select>
  </div>
</div>

<label for="reload">reload (minutes, 0 disables)</label>
<input id="reload" type="text" value="60" />

<div class="btns">
  <button id="gen">Generate</button>
  <button class="secondary" id="copy">Copy Output</button>
  <button class="secondary" id="clear">Clear</button>
</div>

<label for="out">Ready-to-use URL (copy into wallboard URLS map)</label>
<textarea id="out" class="code" readonly></textarea>

<small>
If the output contains %253A or %252F, something is wrong.
Correct encoding contains %3A and %2F only.
</small>

</div>

<script>
function $(id) { return document.getElementById(id); }

function clean(s) {
  return (s || "").trim();
}

function build() {
  const base = clean($("base").value);
  const src = clean($("src").value);
  const fit = $("fit").value;
  const muted = $("muted").value;
  const reload = clean($("reload").value) || "0";

  if (!base) return "Missing player base URL.";
  if (!src) return "Missing stream URL.";

  // IMPORTANT: DO NOT manually encode src.
  // URLSearchParams handles encoding exactly once.
  const params = new URLSearchParams();
  params.set("src", src);
  params.set("fit", fit);
  params.set("muted", muted);

  const r = parseInt(reload, 10);
  if (!isNaN(r) && r > 0) {
    params.set("reload", String(r));
  }

  return base + "?" + params.toString();
}

$("gen").addEventListener("click", () => {
  $("out").value = build();
});

$("copy").addEventListener("click", async () => {
  const value = $("out").value;
  if (!value) return;

  try {
    await navigator.clipboard.writeText(value);
  } catch (e) {
    $("out").focus();
    $("out").select();
    document.execCommand("copy");
  }
});

$("clear").addEventListener("click", () => {
  $("src").value = "";
  $("out").value = "";
  $("src").focus();
});

// Auto-generate as you type
$("src").addEventListener("input", () => {
  if ($("src").value.trim().length > 8) {
    $("out").value = build();
  }
});
$("fit").addEventListener("change", () => $("out").value = build());
$("muted").addEventListener("change", () => $("out").value = build());
$("reload").addEventListener("input", () => $("out").value = build());
$("base").addEventListener("input", () => $("out").value = build());
</script>

</body>
</html>
